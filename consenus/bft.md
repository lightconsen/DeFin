---
icon: '1'
---

# BFT

BFT，全称**拜占庭容错（Byzantine Fault Tolerance）**，是一类分布式共识算法的总称。这类算法旨在解决所谓的“拜占庭将军问题”——即在一个可能发生叛徒（故障节点或恶意节点）欺骗、发送错误信息的分布式系统中，如何让所有忠诚的将军（正常节点）就同一个行动计划达成一致。

BFT机制的核心目标是：**即使系统中存在一定数量的节点（不超过系统容忍极限）发生任意类型的故障（包括恶意行为），整个系统依然能够就交易的顺序和状态达成一致，保证安全性和活性。**

**关键特性：**

1. **安全性（Safety）**：所有正常节点对交易顺序和状态的认知是一致的。绝不会发生“双花”等错误。
2. **活性（Liveness）**：系统最终能够产生新的区块并确认交易，不会无限期卡住。
3. **容错能力**：一个经典的BFT系统（如PBFT）可以容忍 **f** 个拜占庭节点（恶意或故障节点）的破坏，但需要至少 **3f + 1** 个总节点数来达成共识。
   * 公式推导：假设总节点数为 N，恶意节点为 f。我们需要多数正常节点（N - f）来达成一致，但这个多数必须大于恶意节点数 f（否则恶意节点可以伪造多数），即 `N - f > f` => `N > 2f`。为了绝对可靠，通常要求 `N >= 3f + 1`。
   * 这意味着在5个节点的系统中，最多可以容忍 **1** 个恶意节点 (`5 >= 3*1 + 1`)。



Practical Byzantine Fault Tolerance（实用拜占庭容错）是一个经典的BFT算法，其核心过程分为**预准备（Pre-Prepare）**、**准备（Prepare）** 和**提交（Commit）** 三阶段。

1. **请求（Request）**：客户端向主节点（Leader，或称Primary）发送交易请求。
2. **预准备（Pre-Prepare）**：主节点分配一个序列号（Sequence Number）给请求，然后广播一个`预准备`消息给所有副本节点（Replicas）。
3. **准备（Prepare）**：每个副本节点收到`预准备`消息后，验证其合法性。如果验证通过，则广播一个`准备`消息给所有其他节点。当一个节点收到 **2f** 个来自不同节点的、内容正确的`准备`消息（加上它自己的，共 2f+1 个）时，它就进入“准备”状态。
4. **提交（Commit）**：进入“准备”状态的节点广播一个`提交`消息给所有节点。当一个节点收到 **2f** 个内容正确的`提交`消息（加上它自己的，共 2f+1 个）时，它就知道足够多的节点已经达成了共识。此时，它正式**提交**（执行）该请求，并将结果写入本地状态。
5. **回复（Reply）**：节点执行完成后，向客户端发送回复。客户端收到 **f+1** 个相同的回复后，即可确认请求已被系统最终确认。



